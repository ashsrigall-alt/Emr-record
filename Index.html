<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SHREE RAM CLINIC – OPD EMR</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;font-size:13px}
table{border-collapse:collapse;width:100%}
td,th{border:1px solid #000;padding:4px;vertical-align:top}
.header{text-align:center;font-weight:700;font-size:16px}
.sub{text-align:center;font-size:12px}
.no-border td{border:none}
.visit-box{height:40px}
textarea{width:100%;height:100px}
input{width:100%}
button{margin:2px}
@page{size:A4;margin:10mm}
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<table class="no-border">
<tr>
<td style="width:20%">
<img id="qrImg" width="90">
</td>
<td style="width:60%" class="header">
SHREE RAM CLINIC<br>
<span class="sub">ADDRESS – BIRRA, CHAMPA</span><br>
<span class="sub">Department of General Medicine</span>
</td>
<td style="width:20%;text-align:right">
<img id="barImg" width="140">
</td>
</tr>
</table>

<!-- ================= PATIENT DETAILS ================= -->
<table>
<tr>
<td>Name: <span id="pname">Ashwin</span></td>
<td>Age: <span id="page">56</span></td>
<td>Gender: <span id="pgender">Male</span></td>
</tr>
<tr>
<td>Mobile: <span id="pmobile">7908501713</span></td>
<td>UHID: <span id="puhid">UH100000</span></td>
<td>OPD No: <span id="opdno">2</span></td>
</tr>
<tr>
<td colspan="2">Date: <span id="pdate">31/12/2025</span></td>
<td>Doctor: Dr. Ashwini Srivastav</td>
</tr>
</table>

<!-- ================= VISITS ================= -->
<table>
<tr>
<th>Visit 1</th>
<th>Visit 2</th>
<th>Visit 3</th>
<th>Visit 4</th>
</tr>
<tr>
<td class="visit-box"></td>
<td class="visit-box"></td>
<td class="visit-box"></td>
<td class="visit-box"></td>
</tr>
</table>

<!-- ================= NOTES / RX ================= -->
<table>
<tr>
<th style="width:50%">Clinical Notes</th>
<th style="width:50%">Advice / Treatment</th>
</tr>
<tr>
<td>
<textarea id="notes"></textarea>
</td>
<td>
Diagnosis:
<input id="diagnosis"><br><br>

Medicine:
<input id="drug"><br>
Dose:
<input id="dose"><br>

<button onclick="addDose('1-0-1')">1-0-1</button>
<button onclick="addDose('1-1-1')">1-1-1</button>
<button onclick="addDose('1-0-0')">1-0-0</button>
<button onclick="addDose('0-0-1')">0-0-1</button>
<br><br>

Duration:
<input id="duration"><br><br>

<button onclick="addMed()">Add</button>
<ul id="rxList"></ul>

Follow-up:
<input id="followup" type="date"><br><br>

<button onclick="saveVisit()">FINAL SAVE VISIT</button>
</td>
</tr>
</table>

<p style="text-align:center;font-size:11px">
Please retain this card for future visits. UHID: <span id="footuhid">UH100000</span>
</p>

<p style="text-align:right">
Dr. Ashwini Srivastav, MBBS<br>
Reg. No.: 101085 / WBMC
</p>

<script>
let visits = [];
let meds = [];
let PRINT_LANG = 'hi';
const AUTO_KEY = "emr_autosave_visit";

/* ---------- Dose helpers ---------- */
function addDose(d){
  dose.value = (dose.value + ' ' + d).trim();
}

function doseHindi(d){
  return d
   .replace(/1-0-1/g,'सुबह-शाम')
   .replace(/1-1-1/g,'सुबह-दोपहर-शाम')
   .replace(/1-0-0/g,'केवल सुबह')
   .replace(/0-0-1/g,'केवल रात')
   .replace(/after food/gi,'भोजन के बाद')
   .replace(/before food/gi,'भोजन से पहले');
}

/* ---------- Medicines ---------- */
function addMed(){
  if(!drug.value || !dose.value) return;
  meds.push({
    drug: drug.value,
    dose: dose.value,
    duration: duration.value
  });
  drug.value='';dose.value='';duration.value='';
  renderRx();
}

function renderRx(){
  rxList.innerHTML='';
  meds.forEach(m=>{
    let li=document.createElement('li');
    li.innerHTML=`${m.drug} – ${m.dose} (${m.duration})`;
    rxList.appendChild(li);
  });
}

/* ---------- AUTO SAVE ---------- */
function autoSaveVisit(){
  const data = {
    diagnosis: diagnosis.value,
    notes: notes.value,
    meds: meds,
    followup: followup.value
  };
  localStorage.setItem(AUTO_KEY, JSON.stringify(data));
}

(function restoreAutoSave(){
  const saved = localStorage.getItem(AUTO_KEY);
  if(!saved) return;
  const data = JSON.parse(saved);
  diagnosis.value = data.diagnosis || '';
  notes.value = data.notes || '';
  followup.value = data.followup || '';
  meds = data.meds || [];
  renderRx();
})();

setInterval(autoSaveVisit, 3000);

/* ---------- FINAL SAVE VISIT ---------- */
function saveVisit(){
  visits.push({
    diagnosis: diagnosis.value,
    notes: notes.value,
    meds: meds,
    followup: followup.value
  });
  localStorage.removeItem(AUTO_KEY);
  meds=[];
  renderRx();
  diagnosis.value='';notes.value='';followup.value='';
  alert("Visit saved successfully");
}
</script>

</body>
</html>
