<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SHREE RAM CLINIC – EMR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#eef1f5;margin:0}
header{background:#083d77;color:#fff;padding:15px;text-align:center}
.container{padding:15px;max-width:1200px;margin:auto}
.card{background:#fff;padding:15px;margin-bottom:15px;border-radius:8px;
box-shadow:0 2px 6px rgba(0,0,0,.1)}
label{font-weight:bold;display:block;margin-top:8px}
input,select{width:100%;padding:10px;font-size:16px;margin-top:4px}
button{padding:10px 16px;border:none;border-radius:6px;
background:#083d77;color:#fff;margin-top:10px}
button.secondary{background:#555}
.flex{display:flex;gap:10px;flex-wrap:wrap}
.flex>div{flex:1;min-width:140px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;font-size:14px}
th{background:#e6ecf0}
ul{padding-left:18px}
li{margin-bottom:6px}
.tags label{font-weight:normal;margin-right:12px}
.no-print{margin-bottom:10px}
@media print{.no-print{display:none}}
</style>
</head>

<body>
<header>
<h2>SHREE RAM CLINIC</h2>
<p>ADDRESS – BIRRA, CHAMPA.</p>
</header>

<div class="container">

<div class="card">
<h3>Add Patient Visit</h3>

<div class="flex">
<div>
<label>Patient Name *</label>
<input id="patientName">
</div>
<div>
<label>Mobile *</label>
<input id="mobile" onblur="loadLastVisit()">
</div>
</div>

<div class="flex">
<div>
<label>Age</label>
<input id="age" type="number">
</div>
<div>
<label>Gender</label>
<select id="gender">
<option>Male</option><option>Female</option><option>Other</option>
</select>
</div>
</div>

<label>Diagnosis</label>
<input id="diagnosis">

<label>Chronic Diseases</label>
<div class="tags">
<label><input type="checkbox" value="DM"> DM</label>
<label><input type="checkbox" value="HTN"> HTN</label>
<label><input type="checkbox" value="COPD"> COPD</label>
<label><input type="checkbox" value="Asthma"> Asthma</label>
<label><input type="checkbox" value="CKD"> CKD</label>
<label><input type="checkbox" value="IHD"> IHD</label>
</div>

<label>Follow-up Date</label>
<input id="followup" type="date">

<button type="button" onclick="saveRecord()">Save Visit</button>
</div>

<div class="card">
<h3>Patient Records</h3>
<input id="search" placeholder="Search by name or mobile" onkeyup="loadRecords()">

<table>
<thead>
<tr>
<th>UHID</th><th>OPD</th><th>Date</th><th>Name</th>
<th class="no-print">Print</th>
</tr>
</thead>
<tbody id="records"></tbody>
</table>
</div>

</div>

<script>
/* ================= DATA ================= */
function getUHID(m){
let map=JSON.parse(localStorage.getItem('uhidMap')||'{}');
if(!map[m]){
map[m]='UH'+(100000+Object.keys(map).length);
localStorage.setItem('uhidMap',JSON.stringify(map));
}
return map[m];
}

function getOPD(){
let d=new Date().toDateString();
let o=JSON.parse(localStorage.getItem('opd')||'{}');
if(o.date!==d){o={date:d,count:0};}
o.count++;
localStorage.setItem('opd',JSON.stringify(o));
return o.count;
}

function loadLastVisit(){}

function saveRecord(){
let n=patientName.value.trim(), m=mobile.value.trim();
if(n.length<2||m.length<5){alert('Name & mobile required');return;}
let data=JSON.parse(localStorage.getItem('emr')||'[]');
data.push({
uhid:getUHID(m),
opd:getOPD(),
date:new Date().toLocaleString(),
name:n, mobile:m, age:age.value, gender:gender.value
});
localStorage.setItem('emr',JSON.stringify(data));
loadRecords();
}

function loadRecords(){
let q=search.value.toLowerCase();
let data=JSON.parse(localStorage.getItem('emr')||'[]');
records.innerHTML='';
data.filter(r=>r.name.toLowerCase().includes(q)||r.mobile.includes(q))
.forEach((r,i)=>{
let row=records.insertRow();
row.insertCell(0).innerText=r.uhid;
row.insertCell(1).innerText=r.opd;
row.insertCell(2).innerText=r.date;
row.insertCell(3).innerText=r.name;
row.insertCell(4).innerHTML=`<button onclick="printRec(${i})">Print</button>`;
});
}

/* ================= PRINT – A4 OPD CARD ================= */
function printRec(i){
const r=JSON.parse(localStorage.getItem('emr'))[i];
const qr=encodeURIComponent(`UHID:${r.uhid}|Mob:${r.mobile}|Date:${r.date}`);
const w=window.open('','');

w.document.write(`
<html>
<head>
<style>
@page { size:A4; margin:15mm; }
body{font-family:Arial;font-size:12px;margin:0}
.page{width:180mm;min-height:257mm;margin:auto;
display:flex;flex-direction:column}
table{width:100%;border-collapse:collapse}
td{border:1px solid #000;padding:4px;vertical-align:top}
.noborder td{border:none}
.box{height:45mm}
.bigbox{height:110mm}
.center{text-align:center}
.footer{margin-top:auto;text-align:center;font-size:11px}
.signature{text-align:right;margin-top:25mm}
</style>
</head>

<body>
<div class="page">

<table class="noborder">
<tr>
<td style="width:15%">
<img src="https://api.qrserver.com/v1/create-qr-code/?size=90x90&data=${qr}">
</td>
<td style="width:70%" class="center">
<b>SHREE RAM CLINIC</b><br>
ADDRESS – BIRRA, CHAMPA.<br>
Department of General Medicine
</td>
<td style="width:15%" class="center">
<img src="https://barcode.tec-it.com/barcode.ashx?data=${r.uhid}&code=Code128">
</td>
</tr>
</table>

<table>
<tr>
<td>Name: ${r.name}</td>
<td>Age: ${r.age||'-'}</td>
<td>Gender: ${r.gender||'-'}</td>
</tr>
<tr>
<td>Mobile: ${r.mobile}</td>
<td>UHID: ${r.uhid}</td>
<td>OPD No: ${r.opd}</td>
</tr>
<tr>
<td>Date: ${r.date}</td>
<td>Department: General Medicine</td>
<td>Doctor: Dr. Ashwini Srivastav</td>
</tr>
</table>

<table>
<tr class="center">
<td class="box">Visit 1</td>
<td class="box">Visit 2</td>
<td class="box">Visit 3</td>
<td class="box">Visit 4</td>
</tr>
</table>

<table>
<tr class="center">
<td style="width:40%"><b>Clinical Notes</b></td>
<td style="width:60%"><b>Advice / Treatment</b></td>
</tr>
<tr>
<td class="bigbox"></td>
<td class="bigbox"></td>
</tr>
</table>

<div class="footer">
Please retain this card for future visits. UHID: ${r.uhid}
<div class="signature">Doctor Signature & Stamp</div>
</div>

</div>
</body>
</html>
`);
w.print();
}

loadRecords();
</script>
</body>
  </html>
